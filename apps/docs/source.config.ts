import { rehypeCodeDefaultOptions } from "fumadocs-core/mdx-plugins";
import {
  defineConfig,
  defineDocs,
  frontmatterSchema,
  metaSchema,
} from "fumadocs-mdx/config";
import { transformerTwoslash } from "fumadocs-twoslash";
import { createFileSystemTypesCache } from "fumadocs-twoslash/cache-fs";
import z from "zod";

const withTagSchema = {
  tag: z.string().optional()
}

export const docs = defineDocs({
  dir: "content/docs",
  docs: {
    schema: frontmatterSchema.extend(withTagSchema),
    postprocess: {
      includeProcessedMarkdown: true,
    },
  },
  meta: {
    schema: metaSchema.extend(withTagSchema),
  },
});

export default defineConfig({
  mdxOptions: {
    rehypeCodeOptions: {
      lazy: true,
      themes: {
        light: "light-plus",
        dark: "dark-plus"
      },
      langAlias: {
        "pkg-json": "json"
      },
      langs: [
        "json",
        "typescript",
        "javascript",
        "mdx",
        "md",
        "html",
        "css",
        "properties",
        "bash",
        "sh"
      ],
      icon: {
        extend: {
          json: {
            viewBox: "0 0 32 32",
            d: "M19.2 28.8V25.6H24C24.4533 25.6 24.8333 25.4466 25.14 25.14C25.4467 24.8333 25.6 24.4533 25.6 24V20.8C25.6 19.7866 25.8933 18.8666 26.48 18.04C27.0667 17.2133 27.84 16.6266 28.8 16.28V15.72C27.84 15.3733 27.0667 14.7866 26.48 13.96C25.8933 13.1333 25.6 12.2133 25.6 11.2V7.99995C25.6 7.54662 25.4467 7.16662 25.14 6.85995C24.8333 6.55328 24.4533 6.39995 24 6.39995H19.2V3.19995H24C25.3333 3.19995 26.4667 3.66662 27.4 4.59995C28.3333 5.53328 28.8 6.66662 28.8 7.99995V11.2C28.8 11.6533 28.9533 12.0333 29.26 12.34C29.5667 12.6466 29.9467 12.8 30.4 12.8H32V19.2H30.4C29.9467 19.2 29.5667 19.3533 29.26 19.66C28.9533 19.9666 28.8 20.3466 28.8 20.8V24C28.8 25.3333 28.3333 26.4666 27.4 27.4C26.4667 28.3333 25.3333 28.8 24 28.8H19.2ZM8 28.8C6.66667 28.8 5.53333 28.3333 4.6 27.4C3.66667 26.4666 3.2 25.3333 3.2 24V20.8C3.2 20.3466 3.04667 19.9666 2.74 19.66C2.43333 19.3533 2.05333 19.2 1.6 19.2H0V12.8H1.6C2.05333 12.8 2.43333 12.6466 2.74 12.34C3.04667 12.0333 3.2 11.6533 3.2 11.2V7.99995C3.2 6.66662 3.66667 5.53328 4.6 4.59995C5.53333 3.66662 6.66667 3.19995 8 3.19995H12.8V6.39995H8C7.54667 6.39995 7.16667 6.55328 6.86 6.85995C6.55333 7.16662 6.4 7.54662 6.4 7.99995V11.2C6.4 12.2133 6.10667 13.1333 5.52 13.96C4.93333 14.7866 4.16 15.3733 3.2 15.72V16.28C4.16 16.6266 4.93333 17.2133 5.52 18.04C6.10667 18.8666 6.4 19.7866 6.4 20.8V24C6.4 24.4533 6.55333 24.8333 6.86 25.14C7.16667 25.4466 7.54667 25.6 8 25.6H12.8V28.8H8Z",
            fill: "#F9A825"
          },
          typescript: {
            viewBox: "0 0 32 32",
            d: "M0 0H32V32H0V0ZM19.04 26.4187C19.928 28.16 21.7253 29.4933 24.5333 29.4933C27.3787 29.4933 29.512 28.0187 29.512 25.2987C29.512 22.792 28.072 21.672 25.512 20.568L24.7653 20.248C23.4667 19.6987 22.9147 19.3253 22.9147 18.4347C22.9147 17.7067 23.4667 17.1387 24.3547 17.1387C25.208 17.1387 25.7787 17.512 26.2933 18.4347L28.6213 16.888C27.6453 15.1813 26.2587 14.5253 24.3547 14.5253C21.672 14.5253 19.9467 16.232 19.9467 18.488C19.9467 20.9413 21.3867 22.0987 23.5547 23.0213L24.3013 23.3413C25.688 23.9467 26.5067 24.32 26.5067 25.352C26.5067 26.2053 25.7067 26.8267 24.4613 26.8267C22.9867 26.8267 22.1333 26.0613 21.4933 24.9947L19.04 26.4187ZM17.7787 14.6667H8.888V17.3333H11.5547V30.2213H14.6667V17.3333H17.7787V14.6667Z",
            fill: "#0288D1"
          },
          properties: {
            viewBox: "0 0 32 32",
            d: "M27.4549 17.568C27.5189 17.056 27.5669 16.544 27.5669 16C27.5669 15.456 27.5189 14.944 27.4549 14.432L30.8309 11.792C31.1349 11.552 31.2149 11.12 31.0229 10.768L27.8229 5.23206C27.7285 5.06698 27.5785 4.94089 27.3997 4.87639C27.2208 4.81189 27.0248 4.81319 26.8469 4.88006L22.8629 6.48006C22.0309 5.84006 21.1349 5.31206 20.1589 4.91206L19.5509 0.672073C19.5244 0.48382 19.4302 0.311691 19.2858 0.187972C19.1415 0.0642529 18.957 -0.00255637 18.7669 7.48621e-05H12.3669C11.9669 7.48621e-05 11.6309 0.288074 11.5829 0.672073L10.9749 4.91206C9.99891 5.31206 9.10291 5.85606 8.27091 6.48006L4.28692 4.88006C4.19415 4.84859 4.09689 4.83238 3.99892 4.83206C3.72692 4.83206 3.45492 4.97606 3.31092 5.23206L0.11093 10.768C-0.0970693 11.12 -0.00106928 11.552 0.30293 11.792L3.67892 14.432C3.61492 14.944 3.56692 15.472 3.56692 16C3.56692 16.528 3.61492 17.056 3.67892 17.568L0.30293 20.208C-0.00106928 20.448 -0.0810693 20.88 0.11093 21.232L3.31092 26.768C3.40524 26.9331 3.55527 27.0592 3.73412 27.1237C3.91297 27.1882 4.10894 27.1869 4.28692 27.12L8.27091 25.52C9.10291 26.16 9.99891 26.688 10.9749 27.088L11.5829 31.328C11.6309 31.712 11.9669 32 12.3669 32H18.7669C19.1669 32 19.5029 31.712 19.5509 31.328L20.1589 27.088C21.1349 26.688 22.0309 26.144 22.8629 25.52L26.8469 27.12C26.9429 27.152 27.0389 27.168 27.1349 27.168C27.4069 27.168 27.6789 27.024 27.8229 26.768L31.0229 21.232C31.2149 20.88 31.1349 20.448 30.8309 20.208L27.4549 17.568ZM24.2869 14.832C24.3509 15.328 24.3669 15.664 24.3669 16C24.3669 16.336 24.3349 16.688 24.2869 17.168L24.0629 18.976L25.4869 20.096L27.2149 21.44L26.0949 23.376L24.0629 22.56L22.3989 21.888L20.9589 22.976C20.2709 23.488 19.6149 23.872 18.9589 24.144L17.2629 24.832L17.0069 26.64L16.6869 28.8H14.4469L14.1429 26.64L13.8869 24.832L12.1909 24.144C11.5029 23.856 10.8629 23.488 10.2229 23.008L8.76691 21.888L7.07091 22.576L5.03892 23.392L3.91892 21.456L5.64692 20.112L7.07091 18.992L6.84691 17.184C6.79891 16.688 6.76691 16.32 6.76691 16C6.76691 15.68 6.79891 15.312 6.84691 14.832L7.07091 13.024L5.64692 11.904L3.91892 10.5601L5.03892 8.62405L7.07091 9.44005L8.73491 10.1121L10.1749 9.02405C10.8629 8.51205 11.5189 8.12806 12.1749 7.85606L13.8709 7.16806L14.1269 5.36006L14.4469 3.20007H16.6709L16.9749 5.36006L17.2309 7.16806L18.9269 7.85606C19.6149 8.14406 20.2549 8.51205 20.8949 8.99205L22.3509 10.1121L24.0469 9.42405L26.0789 8.60805L27.1989 10.5441L25.4869 11.904L24.0629 13.024L24.2869 14.832ZM15.5669 9.60005C12.0309 9.60005 9.16691 12.464 9.16691 16C9.16691 19.536 12.0309 22.4 15.5669 22.4C19.1029 22.4 21.9669 19.536 21.9669 16C21.9669 12.464 19.1029 9.60005 15.5669 9.60005ZM15.5669 19.2C13.8069 19.2 12.3669 17.76 12.3669 16C12.3669 14.24 13.8069 12.8 15.5669 12.8C17.3269 12.8 18.7669 14.24 18.7669 16C18.7669 17.76 17.3269 19.2 15.5669 19.2Z",
            fill: "#42A5F5"
          },
          shellscript: {
            viewBox: "0 0 32 32",
            d: "M28.8 27.2V7.99998H3.2V27.2H28.8ZM28.8 1.59998C29.6487 1.59998 30.4626 1.93712 31.0627 2.53723C31.6629 3.13735 32 3.95128 32 4.79998V27.2C32 28.0487 31.6629 28.8626 31.0627 29.4627C30.4626 30.0628 29.6487 30.4 28.8 30.4H3.2C2.35131 30.4 1.53737 30.0628 0.937258 29.4627C0.337142 28.8626 0 28.0487 0 27.2V4.79998C0 3.95128 0.337142 3.13735 0.937258 2.53723C1.53737 1.93712 2.35131 1.59998 3.2 1.59998H28.8ZM17.6 24V20.8H25.6V24H17.6ZM12.128 17.6L5.712 11.2H10.24L15.52 16.48C16.144 17.104 16.144 18.128 15.52 18.752L10.272 24H5.744L12.128 17.6Z",
            fill: "#FF7043"
          },
          dotenv: {
            viewBox: "0 0 32 32",
            d: "M11.4287 20.5713H6.85742V29.7139H4.57129V20.5713H0V18.2861H11.4287V20.5713ZM18.2861 29.7139H16V16H18.2861V29.7139ZM32 25.1426H27.4287V29.7139H25.1426V25.1426H20.5713V22.8574H32V25.1426ZM27.4287 18.2861H25.1426V2.28613H27.4287V18.2861ZM6.85742 13.7139H4.57129V2.28613H6.85742V13.7139ZM18.2861 9.14258H22.8574V11.4287H11.4287V9.14258H16V2.28613H18.2861V9.14258Z",
            fill: "#FBC02D"
          },
          dockerfile: {
            viewBox: "0 0 32 32",
            d: "M31.696 13.2C31.6 13.136 30.8 12.512 29.072 12.512C28.624 12.512 28.176 12.56 27.728 12.64C27.392 10.4 25.52 9.26402 25.44 9.21602L24.976 8.94402L24.688 9.37602C24.304 9.95202 24 10.608 23.872 11.28C23.552 12.56 23.744 13.776 24.4 14.816C23.616 15.264 22.336 15.376 22.064 15.376H0.992C0.448 15.376 0 15.824 0 16.384C0 18.224 0.288 20.064 0.928 21.792C1.648 23.696 2.736 25.104 4.128 25.968C5.696 26.928 8.272 27.472 11.2 27.472C12.464 27.472 13.776 27.36 15.072 27.12C16.864 26.8 18.592 26.176 20.176 25.264C21.4879 24.5139 22.6621 23.5453 23.648 22.4C25.328 20.528 26.32 18.4 27.04 16.56H27.344C29.168 16.56 30.304 15.824 30.928 15.2C31.344 14.816 31.648 14.352 31.872 13.808L32 13.424L31.696 13.2ZM2.96 14.784H5.776C5.904 14.784 6.032 14.672 6.032 14.528V12C6.032 11.872 5.92 11.744 5.776 11.744H2.96C2.816 11.744 2.704 11.856 2.704 12V14.528C2.72 14.672 2.816 14.784 2.96 14.784ZM6.848 14.784H9.664C9.792 14.784 9.92 14.672 9.92 14.528V12C9.92 11.872 9.808 11.744 9.664 11.744H6.848C6.704 11.744 6.592 11.856 6.592 12V14.528C6.608 14.672 6.704 14.784 6.848 14.784ZM10.8 14.784H13.6C13.76 14.784 13.872 14.672 13.872 14.528V12C13.872 11.872 13.776 11.744 13.6 11.744H10.8C10.672 11.744 10.56 11.856 10.56 12V14.528C10.56 14.672 10.656 14.784 10.8 14.784ZM14.704 14.784H17.536C17.664 14.784 17.776 14.672 17.776 14.528V12C17.776 11.872 17.68 11.744 17.536 11.744H14.704C14.576 11.744 14.464 11.856 14.464 12V14.528C14.464 14.672 14.576 14.784 14.704 14.784ZM6.848 11.2H9.664C9.792 11.2 9.92 11.056 9.92 10.912V8.40002C9.92 8.25602 9.808 8.14402 9.664 8.14402H6.848C6.704 8.14402 6.592 8.24002 6.592 8.40002V10.912C6.608 11.056 6.704 11.2 6.848 11.2ZM10.8 11.2H13.6C13.76 11.2 13.872 11.056 13.872 10.912V8.40002C13.872 8.25602 13.776 8.14402 13.6 8.14402H10.8C10.672 8.14402 10.56 8.24002 10.56 8.40002V10.912C10.56 11.056 10.656 11.2 10.8 11.2ZM14.704 11.2H17.536C17.664 11.2 17.776 11.056 17.776 10.912V8.40002C17.776 8.25602 17.664 8.14402 17.536 8.14402H14.704C14.576 8.14402 14.464 8.24002 14.464 8.40002V10.912C14.464 11.056 14.576 11.2 14.704 11.2ZM14.704 7.55202H17.536C17.664 7.55202 17.776 7.44002 17.776 7.29602V4.80002C17.776 4.64002 17.664 4.52802 17.536 4.52802H14.704C14.576 4.52802 14.464 4.62402 14.464 4.80002V7.29602C14.464 7.42402 14.576 7.55202 14.704 7.55202ZM18.64 14.784H21.456C21.6 14.784 21.712 14.672 21.712 14.528V12C21.712 11.872 21.6 11.744 21.456 11.744H18.64C18.512 11.744 18.4 11.856 18.4 12V14.528C18.4 14.672 18.512 14.784 18.64 14.784Z",
            fill: "#0288D1"
          }
        }
      },
      transformers: [
        ...(rehypeCodeDefaultOptions.transformers ?? []),
        transformerTwoslash({
          typesCache: createFileSystemTypesCache(),
        })
      ]
    }
  },
});
